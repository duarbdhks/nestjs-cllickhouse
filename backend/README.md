# Kafka-ClickHouse Analytics Backend

**NestJS ê¸°ë°˜ ì´ë²¤íŠ¸ ê¸°ë°˜ E-Commerce ë¶„ì„ íŒŒì´í”„ë¼ì¸ ë°±ì—”ë“œ**

ì´ ë°±ì—”ë“œëŠ” Outbox Patternê³¼ Kafkaë¥¼ í™œìš©í•œ ì´ë²¤íŠ¸ ê¸°ë°˜ ì•„í‚¤í…ì²˜ë¡œ MySQL(OLTP)ê³¼ ClickHouse(OLAP) ê°„ì˜ ì‹¤ì‹œê°„ ë°ì´í„° ë™ê¸°í™”ë¥¼ ë‹´ë‹¹í•©ë‹ˆë‹¤.

## ğŸ“‹ ëª©ì°¨

- [ì•„í‚¤í…ì²˜ ê°œìš”](#ì•„í‚¤í…ì²˜-ê°œìš”)
- [êµ¬í˜„ëœ ëª¨ë“ˆ](#êµ¬í˜„ëœ-ëª¨ë“ˆ)
- [UI ìŠ¤í¬ë¦°ìƒ·](#ui-ìŠ¤í¬ë¦°ìƒ·)
- [API ì—”ë“œí¬ì¸íŠ¸](#api-ì—”ë“œí¬ì¸íŠ¸)
- [í™˜ê²½ ì„¤ì •](#í™˜ê²½-ì„¤ì •)
- [ì‹¤í–‰ ë°©ë²•](#ì‹¤í–‰-ë°©ë²•)
- [ë°ì´í„° í”Œë¡œìš°](#ë°ì´í„°-í”Œë¡œìš°)
- [í”„ë¡œì íŠ¸ êµ¬ì¡°](#í”„ë¡œì íŠ¸-êµ¬ì¡°)
- [ì•Œë ¤ì§„ ì œì•½ì‚¬í•­](#ì•Œë ¤ì§„-ì œì•½ì‚¬í•­)

## ğŸ—ï¸ ì•„í‚¤í…ì²˜ ê°œìš”

### ê¸°ìˆ  ìŠ¤íƒ

- **í”„ë ˆì„ì›Œí¬**: NestJS 11.0.1
- **ì–¸ì–´**: TypeScript 5.7.3
- **ORM**: TypeORM 0.3.27
- **ë°ì´í„°ë² ì´ìŠ¤**: MySQL 8.0 (OLTP), ClickHouse 25.1 (OLAP)
- **ë©”ì‹œì§•**: KafkaJS 2.2.4
- **ì‘ì—… ìŠ¤ì¼€ì¤„ë§**: @nestjs/schedule 6.0.1
- **ê²€ì¦**: class-validator, class-transformer

### í•µì‹¬ íŒ¨í„´

**Outbox Pattern**: íŠ¸ëœì­ì…˜ ì¼ê´€ì„±ì„ ë³´ì¥í•˜ë©° ì´ë²¤íŠ¸ë¥¼ ì•ˆì „í•˜ê²Œ ë°œí–‰

- Order ìƒì„±ê³¼ Outbox ì´ë²¤íŠ¸ê°€ ë™ì¼ MySQL íŠ¸ëœì­ì…˜ì—ì„œ ì²˜ë¦¬
- Cron ê¸°ë°˜ í´ë§(5ì´ˆ ê°„ê²©)ìœ¼ë¡œ ë¯¸ì²˜ë¦¬ ì´ë²¤íŠ¸ë¥¼ Kafkaë¡œ ì „ì†¡
- `processed` í”Œë˜ê·¸ë¡œ ì¤‘ë³µ ì²˜ë¦¬ ë°©ì§€

**ì´ë²¤íŠ¸ ë³€í™˜ (Event Transformation)**: Kafka Consumerê°€ ë¶„ì„ìš© í¬ë§·ìœ¼ë¡œ ë³€í™˜

- `order.events` í† í”½ì—ì„œ ì›ë³¸ ì´ë²¤íŠ¸ ìˆ˜ì‹ 
- ë¶„ì„ìš© ìŠ¤í‚¤ë§ˆë¡œ ë³€í™˜ í›„ `orders_analytics` í† í”½ ë°œí–‰
- Kafka Connect Sinkê°€ ClickHouseë¡œ ìë™ ì ì¬

## ğŸ§© êµ¬í˜„ëœ ëª¨ë“ˆ

### 1. Order Module (`src/order`)

ì£¼ë¬¸ ê´€ë¦¬ ë° ìƒì„± ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.

**ì—”í‹°í‹°**: `OrderEntity`, `OrderItemEntity`
**ê¸°ëŠ¥**:

- ì£¼ë¬¸ ìƒì„± with Outbox Pattern (íŠ¸ëœì­ì…˜ ë³´ì¥)
- ì£¼ë¬¸ ì¡°íšŒ (ì‚¬ìš©ìë³„, ì „ì²´)
- ì£¼ë¬¸ ì‚­ì œ with Soft Delete + TTL (Admin only)
- OrderStatus ê´€ë¦¬ (9ê°€ì§€ ìƒíƒœ: PENDING, CONFIRMED, PROCESSING, SHIPPED, DELIVERED, CANCELLED, REFUNDED, FAILED, COMPLETED)

**API**:

```
POST   /api/orders          # ì£¼ë¬¸ ìƒì„±
GET    /api/orders/:id      # ì£¼ë¬¸ ì¡°íšŒ
GET    /api/orders/user/:userId  # ì‚¬ìš©ìë³„ ì£¼ë¬¸ ëª©ë¡

# Admin API
DELETE /admin/orders/:id    # ì£¼ë¬¸ ì‚­ì œ (Soft Delete, X-Admin-Id header í•„ìˆ˜)
```

### 2. Outbox Module (`src/outbox`)

ì´ë²¤íŠ¸ ì•„ì›ƒë°•ìŠ¤ íŒ¨í„´ì„ êµ¬í˜„í•©ë‹ˆë‹¤.

**ì—”í‹°í‹°**: `OutboxEntity`
**ì„œë¹„ìŠ¤**:

- `OutboxService`: ì´ë²¤íŠ¸ ì €ì¥ ë° ì¡°íšŒ
- `OutboxRelayService`: Cron ê¸°ë°˜ ì´ë²¤íŠ¸ ë¦´ë ˆì´ (5ì´ˆ ê°„ê²©)

**Cron ì„¤ì •**:

```typescript
@Cron('*/5 * * * * *')  // 5ì´ˆë§ˆë‹¤ ì‹¤í–‰
async
relayOutboxEvents()
{
  // ë¯¸ì²˜ë¦¬ ì´ë²¤íŠ¸ 100ê°œì”© ë°°ì¹˜ ì²˜ë¦¬
  // Kafka ë°œí–‰ ì„±ê³µ ì‹œ processed = trueë¡œ ì—…ë°ì´íŠ¸
}
```

### 3. Kafka Module (`src/kafka`)

Kafka Producer/Consumer í†µí•©ì„ ì œê³µí•©ë‹ˆë‹¤.

**ì„œë¹„ìŠ¤**:

- `KafkaProducerService`: Kafka ë©”ì‹œì§€ ë°œí–‰
- `KafkaConsumerService`: ì´ë²¤íŠ¸ ë³€í™˜ ë° ì¬ë°œí–‰

**í† í”½**:

- `order.events`: Outbox ì´ë²¤íŠ¸ ì›ë³¸
- `orders_analytics`: ë¶„ì„ìš© ë³€í™˜ ë°ì´í„°

**Consumer Group**: `order-event-transformer`

### 4. ClickHouse Module (`src/clickhouse`)

ClickHouse OLAP ë°ì´í„°ë² ì´ìŠ¤ì™€ì˜ ì—°ê²°ì„ ê´€ë¦¬í•©ë‹ˆë‹¤.

**í´ë¼ì´ì–¸íŠ¸**: `@clickhouse/client` v1.12.1
**ê¸°ëŠ¥**:

- ClickHouse ì¿¼ë¦¬ ì‹¤í–‰
- Materialized View ì¡°íšŒ
- í—¬ìŠ¤ì²´í¬

### 5. Analytics Module (`src/analytics`)

ì‹¤ì‹œê°„ ë¶„ì„ APIë¥¼ ì œê³µí•©ë‹ˆë‹¤.

**API ì—”ë“œí¬ì¸íŠ¸**:

```
GET /api/analytics/daily-sales     # ì¼ë³„ ë§¤ì¶œ ì§‘ê³„
GET /api/analytics/hourly-sales    # ì‹œê°„ë³„ ì£¼ë¬¸ ì§‘ê³„
GET /api/analytics/order-status    # ì£¼ë¬¸ ìƒíƒœë³„ ë¶„í¬
GET /api/analytics/stats            # ì „ì²´ í†µê³„
GET /api/analytics/health           # ClickHouse ì—°ê²° ìƒíƒœ
```

### 6. User Module (`src/user`)

ì‚¬ìš©ì ê´€ë¦¬ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.

**ì—”í‹°í‹°**: `UserEntity`

### 7. Product Module (`src/product`)

ìƒí’ˆ ê´€ë¦¬ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.

**ì—”í‹°í‹°**: `ProductEntity`

### 8. Admin Orders Module (`src/order/admin`)

ê´€ë¦¬ì ì „ìš© ì£¼ë¬¸ ê´€ë¦¬ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.

**ì»¨íŠ¸ë¡¤ëŸ¬**: `AdminOrdersController`
**ê¸°ëŠ¥**:

- ì£¼ë¬¸ Soft Delete (ë³µêµ¬ ê°€ëŠ¥)
- OrderDeleted ì´ë²¤íŠ¸ ë°œí–‰ (Outbox Pattern)
- Admin ê°ì‚¬ ì¶”ì  (X-Admin-Id header)

**API**:

```
DELETE /admin/orders/:id    # ì£¼ë¬¸ ì‚­ì œ
  Headers: X-Admin-Id (required) - Admin user ID for audit trail
  Response: 204 No Content
```

**ì‚­ì œ ì´ë²¤íŠ¸**: `OrderDeletedEvent`
```typescript
{
  eventType: 'OrderDeleted',
  orderId: string,
  deletedAt: string,        // ISO 8601 timestamp
  deletedBy: string,         // Admin user ID
  version: number            // Unix timestamp in milliseconds
}
```

### 9. Static UI (`public/`)

ì •ì  HTML ëŒ€ì‹œë³´ë“œë¥¼ ì œê³µí•©ë‹ˆë‹¤.

**íŒŒì¼**:

- `index.html`: ë©”ì¸ ëŒ€ì‹œë³´ë“œ
- `dashboard.html`: ë¶„ì„ ëŒ€ì‹œë³´ë“œ
- `css/`: ìŠ¤íƒ€ì¼ì‹œíŠ¸

**ì ‘ê·¼**: `http://localhost:3000/`

## ğŸ¨ UI ìŠ¤í¬ë¦°ìƒ·

### ë¶„ì„ ëŒ€ì‹œë³´ë“œ (Dashboard)

ì‹¤ì‹œê°„ ë¶„ì„ ë°ì´í„°ë¥¼ ì‹œê°í™”í•˜ëŠ” ë©”ì¸ ëŒ€ì‹œë³´ë“œì…ë‹ˆë‹¤.

![ë¶„ì„ ëŒ€ì‹œë³´ë“œ](doc/img.png)

**ì£¼ìš” ê¸°ëŠ¥**:
- **ì‹œìŠ¤í…œ ìƒíƒœ**: ClickHouse ì—°ê²° ìƒíƒœ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§
- **í•µì‹¬ ì§€í‘œ**: ì´ ì£¼ë¬¸ ìˆ˜, ì´ ë§¤ì¶œ, ê³ ê° ìˆ˜ í•œëˆˆì— í™•ì¸
- **ì¼ë³„ ë§¤ì¶œ ì§‘ê³„**: ë‚ ì§œë³„ ì£¼ë¬¸ ê±´ìˆ˜ ë° ë§¤ì¶œì•¡ ìƒì„¸ ë¶„ì„
- **ì‹œê°„ë³„ ì£¼ë¬¸ ì§‘ê³„**: ì‹œê°„ëŒ€ë³„ ì£¼ë¬¸ íŒ¨í„´ ë¶„ì„ (ìµœê·¼ 24ì‹œê°„)
- **ì£¼ë¬¸ ìƒíƒœë³„ ë¶„í¬**: DELIVERED, PENDING, PREPARED ë“± ìƒíƒœë³„ ì£¼ë¬¸ ë¶„í¬ ë° ê¸ˆì•¡

**ì ‘ì†**: `http://localhost:3000` ë˜ëŠ” `http://localhost:3000/dashboard.html`

---

### ìƒí’ˆ ëª©ë¡ (E-Commerce Shop)

E-Commerce ìƒí’ˆ ì¹´íƒˆë¡œê·¸ ë° ì¥ë°”êµ¬ë‹ˆ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.

![ìƒí’ˆ ëª©ë¡](doc/img_1.png)

**ì£¼ìš” ê¸°ëŠ¥**:
- **ìƒí’ˆ ì¹´íƒˆë¡œê·¸**: Laptop, Wireless Mouse, Coffee Maker ë“± ë‹¤ì–‘í•œ ìƒí’ˆ ëª©ë¡
- **ì¥ë°”êµ¬ë‹ˆ**: ì„ íƒí•œ ìƒí’ˆ ë‹´ê¸° ë° ì£¼ë¬¸ ê´€ë¦¬
- **ì£¼ë¬¸ ì •ë³´**: ì‚¬ìš©ì ì„ íƒ ë° ë°°ì†¡ì§€ ì •ë³´ ì…ë ¥
- **íƒ€ì„ìŠ¤íƒ¬í”„ ì¶”ì²œ**: 10ê°œ ì£¼ë¬¸ ìƒì„± ê¸°ëŠ¥ (ë°ëª¨ ë° í…ŒìŠ¤íŠ¸ìš©)

**ì ‘ì†**: `http://localhost:3000/index.html`

## ğŸ”Œ API ì—”ë“œí¬ì¸íŠ¸

### Order API

| Method | Endpoint                   | Description | Request Body     |
|--------|----------------------------|-------------|------------------|
| POST   | `/api/orders`              | ì£¼ë¬¸ ìƒì„±       | `CreateOrderDto` |
| GET    | `/api/orders/:id`          | ì£¼ë¬¸ ì¡°íšŒ       | -                |
| GET    | `/api/orders/user/:userId` | ì‚¬ìš©ìë³„ ì£¼ë¬¸ ëª©ë¡  | -                |

### Admin Orders API

| Method | Endpoint              | Description | Headers            | Response |
|--------|-----------------------|-------------|--------------------|----------|
| DELETE | `/admin/orders/:id`   | ì£¼ë¬¸ ì‚­ì œ (Soft Delete) | `X-Admin-Id` (required) | 204 No Content |

**ì‚­ì œ ìš”ì²­ ì˜ˆì‹œ**:
```bash
curl -X DELETE http://localhost:3000/admin/orders/{orderId} \
  -H "X-Admin-Id: admin-user-123"
```

**CreateOrderDto ì˜ˆì‹œ**:

```json
{
  "userId": 1,
  "status": "PENDING",
  "totalAmount": 50000,
  "items": [
    {
      "productId": 101,
      "quantity": 2,
      "price": 25000
    }
  ]
}
```

### Analytics API

| Method | Endpoint                      | Query Parameters                | Description      |
|--------|-------------------------------|---------------------------------|------------------|
| GET    | `/api/analytics/daily-sales`  | `startDate`, `endDate`          | ì¼ë³„ ë§¤ì¶œ ì§‘ê³„         |
| GET    | `/api/analytics/hourly-sales` | `startDate`, `endDate`, `limit` | ì‹œê°„ë³„ ì£¼ë¬¸ ì§‘ê³„        |
| GET    | `/api/analytics/order-status` | `startDate`, `endDate`          | ì£¼ë¬¸ ìƒíƒœë³„ ë¶„í¬        |
| GET    | `/api/analytics/stats`        | -                               | ì „ì²´ í†µê³„            |
| GET    | `/api/analytics/health`       | -                               | ClickHouse ì—°ê²° ìƒíƒœ |

**ì‘ë‹µ ì˜ˆì‹œ** (`GET /api/analytics/stats`):

```json
{
  "totalOrders": 1523,
  "totalRevenue": 45678900,
  "averageOrderValue": 29980,
  "totalProducts": 234,
  "totalUsers": 892
}
```

## âš™ï¸ í™˜ê²½ ì„¤ì •

### í™˜ê²½ ë³€ìˆ˜ (.env)

`.env.example` íŒŒì¼ì„ `.env`ë¡œ ë³µì‚¬í•˜ì—¬ ì„¤ì •í•˜ì„¸ìš”.

```bash
# Application
NODE_ENV=development
PORT=3000

# MySQL (OLTP)
MYSQL_HOST=localhost
MYSQL_PORT=3306
MYSQL_USER=admin
MYSQL_PASSWORD=test123
MYSQL_DATABASE=ecommerce

# Kafka
KAFKA_BROKERS=localhost:19092,localhost:19093,localhost:19094
KAFKA_CLIENT_ID=ecommerce-backend
KAFKA_CONSUMER_GROUP_ID=order-event-transformer

# ClickHouse (OLAP)
CLICKHOUSE_HOST=http://localhost:8123
CLICKHOUSE_USER=admin
CLICKHOUSE_PASSWORD=test123
CLICKHOUSE_DATABASE=analytics

# Outbox Relay
OUTBOX_BATCH_SIZE=100
OUTBOX_POLLING_INTERVAL=*/5 * * * * *
```

### í•„ìˆ˜ ì„œë¹„ìŠ¤

ë°±ì—”ë“œ ì‹¤í–‰ ì „ì— ë‹¤ìŒ ì„œë¹„ìŠ¤ê°€ ì‹¤í–‰ ì¤‘ì´ì–´ì•¼ í•©ë‹ˆë‹¤:

1. **MySQL** (localhost:3306)
2. **Kafka 3-node Cluster** (localhost:19092, 19093, 19094)
3. **ClickHouse** (localhost:8123)

**ì¸í”„ë¼ ì‹œì‘** (í”„ë¡œì íŠ¸ ë£¨íŠ¸ì—ì„œ):

```bash
cd ..
make setup    # ì „ì²´ ì¸í”„ë¼ ì‹œì‘ + DB ì´ˆê¸°í™”
```

## ğŸš€ ì‹¤í–‰ ë°©ë²•

### 1. ì˜ì¡´ì„± ì„¤ì¹˜

```bash
npm install
```

### 2. í™˜ê²½ ì„¤ì •

```bash
cp .env.example .env
# .env íŒŒì¼ ìˆ˜ì • (í•„ìš”ì‹œ)
```

### 3. ê°œë°œ ëª¨ë“œ ì‹¤í–‰

```bash
# Watch ëª¨ë“œ (hot reload)
npm run start:dev

# ì¼ë°˜ ê°œë°œ ëª¨ë“œ
npm run start

# ë””ë²„ê·¸ ëª¨ë“œ
npm run start:debug
```

**ì ‘ì† í™•ì¸**:

- ë°±ì—”ë“œ API: http://localhost:3000/api
- HTML ëŒ€ì‹œë³´ë“œ: http://localhost:3000

### 4. í”„ë¡œë•ì…˜ ë¹Œë“œ

```bash
# ë¹Œë“œ
npm run build

# í”„ë¡œë•ì…˜ ì‹¤í–‰
npm run start:prod
```

### 5. í…ŒìŠ¤íŠ¸

```bash
# ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
npm run test

# E2E í…ŒìŠ¤íŠ¸
npm run test:e2e

# í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€
npm run test:cov

# Order Deletion Flow E2E í…ŒìŠ¤íŠ¸
cd ..
./scripts/test-deletion-flow.sh
```

**ì‚­ì œ í”Œë¡œìš° í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤**:
1. í…ŒìŠ¤íŠ¸ ì£¼ë¬¸ ìƒì„± (POST /api/orders)
2. MySQL ì£¼ë¬¸ í™•ì¸
3. ClickHouse ì „íŒŒ í™•ì¸ (15ì´ˆ ëŒ€ê¸°)
4. Admin APIë¡œ ì£¼ë¬¸ ì‚­ì œ (DELETE /admin/orders/:id)
5. MySQL soft delete í™•ì¸ (deleted_at ì„¤ì •)
6. ClickHouse ì‚­ì œ ì´ë²¤íŠ¸ í™•ì¸ (is_deleted=1, event_type=DELETED)
7. Materialized Views í•„í„°ë§ í™•ì¸ (ì‚­ì œëœ ì£¼ë¬¸ ì œì™¸)

## ğŸ”„ ë°ì´í„° í”Œë¡œìš°

### ì „ì²´ íŒŒì´í”„ë¼ì¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. Order Creation (REST API)                               â”‚
â”‚  POST /api/orders                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. MySQL Transaction (OLTP)                                â”‚
â”‚  - orders í…Œì´ë¸” INSERT                                      â”‚
â”‚  - order_items í…Œì´ë¸” INSERT                                 â”‚
â”‚  - outbox í…Œì´ë¸” INSERT (ë™ì¼ íŠ¸ëœì­ì…˜)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. Outbox Relay (Cron 5ì´ˆ í´ë§)                            â”‚
â”‚  OutboxRelayService                                          â”‚
â”‚  - processed = falseì¸ ì´ë²¤íŠ¸ 100ê°œ ì¡°íšŒ                     â”‚
â”‚  - Kafka order.events í† í”½ìœ¼ë¡œ ë°œí–‰                          â”‚
â”‚  - processed = trueë¡œ ì—…ë°ì´íŠ¸                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. Kafka order.events Topic                                â”‚
â”‚  - Replication Factor: 3                                     â”‚
â”‚  - Partitions: 3                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. Kafka Consumer (Event Transformer)                      â”‚
â”‚  KafkaConsumerService                                        â”‚
â”‚  - order.events êµ¬ë…                                         â”‚
â”‚  - OrderCreated/OrderDeleted ì´ë²¤íŠ¸ ë³€í™˜                    â”‚
â”‚  - ë¶„ì„ìš© ìŠ¤í‚¤ë§ˆë¡œ ë§¤í•‘                                      â”‚
â”‚  - orders_analytics í† í”½ìœ¼ë¡œ ì¬ë°œí–‰                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  6. Kafka orders_analytics Topic                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  7. Kafka Connect ClickHouse Sink                           â”‚
â”‚  - orders_analytics í† í”½ êµ¬ë…                                â”‚
â”‚  - ClickHouse orders_analytics í…Œì´ë¸”ë¡œ ìë™ ì ì¬            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  8. ClickHouse (OLAP)                                       â”‚
â”‚  - orders_analytics í…Œì´ë¸” (ReplacingMergeTree)             â”‚
â”‚  - Materialized Views:                                       â”‚
â”‚    â€¢ daily_sales_mv: ì¼ë³„ ë§¤ì¶œ ì§‘ê³„                         â”‚
â”‚    â€¢ hourly_sales_mv: ì‹œê°„ë³„ ì£¼ë¬¸ ì§‘ê³„                      â”‚
â”‚    â€¢ order_status_mv: ì£¼ë¬¸ ìƒíƒœë³„ ë¶„í¬                      â”‚
â”‚    â€¢ user_analytics_mv: ì‚¬ìš©ìë³„ ì£¼ë¬¸ í†µê³„                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  9. Analytics API                                           â”‚
â”‚  GET /api/analytics/*                                        â”‚
â”‚  - ClickHouseServiceë¡œ Materialized View ì¿¼ë¦¬               â”‚
â”‚  - ì‹¤ì‹œê°„ ì§‘ê³„ ë°ì´í„° ì œê³µ                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Order Deletion Flow (Soft Delete + TTL)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. Admin API Call                                          â”‚
â”‚  DELETE /admin/orders/:id                                    â”‚
â”‚  Header: X-Admin-Id (required for audit trail)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. MySQL Transaction                                        â”‚
â”‚  - orders.deleted_at = NOW() (Soft Delete)                  â”‚
â”‚  - outbox INSERT OrderDeleted event (ë™ì¼ íŠ¸ëœì­ì…˜)          â”‚
â”‚    payload: { orderId, deletedAt, deletedBy, version }      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. Outbox Relay (Cron 5ì´ˆ í´ë§)                            â”‚
â”‚  - OrderDeleted ì´ë²¤íŠ¸ë¥¼ Kafka order.events í† í”½ìœ¼ë¡œ ë°œí–‰   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. Kafka Consumer (Event Transformer)                      â”‚
â”‚  - OrderDeleted ì´ë²¤íŠ¸ ìˆ˜ì‹                                   â”‚
â”‚  - MySQLì—ì„œ Order + User + OrderItem ë°ì´í„° ì¡°íšŒ (Hybrid)  â”‚
â”‚  - ì‚­ì œ í¬ë§·ìœ¼ë¡œ ë³€í™˜:                                       â”‚
â”‚    â€¢ event_type: 'DELETED'                                   â”‚
â”‚    â€¢ is_deleted: 1                                           â”‚
â”‚    â€¢ deleted_at: timestamp                                   â”‚
â”‚    â€¢ version: Unix timestamp (ms)                            â”‚
â”‚  - orders_analytics í† í”½ìœ¼ë¡œ ì¬ë°œí–‰                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. ClickHouse ReplacingMergeTree                           â”‚
â”‚  - ë™ì¼ order_idì— ëŒ€í•´ ìƒˆ ë²„ì „ INSERT                       â”‚
â”‚  - FINAL ì¿¼ë¦¬ ì‹œ version ë†’ì€ rowê°€ ì„ íƒë¨                  â”‚
â”‚  - ê²°ê³¼: is_deleted=1, deleted_at ì„¤ì •ëœ ìµœì‹  ë²„ì „          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  6. Materialized Views Filtering                            â”‚
â”‚  - ëª¨ë“  MVëŠ” WHERE is_deleted=0 í•„í„° ì ìš©                   â”‚
â”‚  - ì‚­ì œëœ ì£¼ë¬¸ì€ ìë™ìœ¼ë¡œ ì§‘ê³„ì—ì„œ ì œì™¸                      â”‚
â”‚  - daily_sales_mv, hourly_sales_mv ë“± ëª¨ë‘ ì •í™•í•œ í†µê³„ ìœ ì§€ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  7. TTL Physical Deletion (7 days later)                    â”‚
â”‚  - TTL: deleted_at + INTERVAL 7 DAY DELETE                  â”‚
â”‚  - is_deleted=1ì¸ rowëŠ” 7ì¼ í›„ ìë™ ë¬¼ë¦¬ ì‚­ì œ               â”‚
â”‚  - ë³µêµ¬ ê°€ëŠ¥ ê¸°ê°„: 7ì¼ (Soft Delete ê¸°ê°„)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë ˆì´í„´ì‹œ ëª©í‘œ (MVP)

| êµ¬ê°„                 | ëª©í‘œ        | ì¸¡ì • ë°©ë²•                    |
|--------------------|-----------|--------------------------|
| API â†’ MySQL        | <50ms     | REST API ì‘ë‹µ ì‹œê°„           |
| Outbox â†’ Kafka     | 5-10ì´ˆ     | Polling interval (5ì´ˆ)    |
| Kafka â†’ ClickHouse | ì‹¤ì‹œê°„       | Kafka Connect ìë™ ì²˜ë¦¬      |
| Analytics Query    | <100ms    | Materialized View ì¿¼ë¦¬     |
| **ì „ì²´ E2E**         | **5-10ì´ˆ** | Order ìƒì„± â†’ ClickHouse ë°˜ì˜ |

## ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ analytics/              # Analytics API ëª¨ë“ˆ
â”‚   â”‚   â”œâ”€â”€ analytics.controller.ts
â”‚   â”‚   â”œâ”€â”€ analytics.service.ts
â”‚   â”‚   â””â”€â”€ analytics.module.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ clickhouse/             # ClickHouse í†µí•© ëª¨ë“ˆ
â”‚   â”‚   â”œâ”€â”€ clickhouse.service.ts
â”‚   â”‚   â”œâ”€â”€ clickhouse.module.ts
â”‚   â”‚   â””â”€â”€ dto/
â”‚   â”‚       â”œâ”€â”€ daily-sales.dto.ts
â”‚   â”‚       â”œâ”€â”€ hourly-sales.dto.ts
â”‚   â”‚       â”œâ”€â”€ order-status.dto.ts
â”‚   â”‚       â””â”€â”€ overall-stats.dto.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ kafka/                  # Kafka Producer/Consumer ëª¨ë“ˆ
â”‚   â”‚   â”œâ”€â”€ kafka-producer.service.ts
â”‚   â”‚   â”œâ”€â”€ kafka-consumer.service.ts
â”‚   â”‚   â””â”€â”€ kafka.module.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ order/                  # ì£¼ë¬¸ ê´€ë¦¬ ëª¨ë“ˆ
â”‚   â”‚   â”œâ”€â”€ order.controller.ts
â”‚   â”‚   â”œâ”€â”€ order.service.ts
â”‚   â”‚   â”œâ”€â”€ order.module.ts
â”‚   â”‚   â”œâ”€â”€ entities/
â”‚   â”‚   â”‚   â”œâ”€â”€ order.entity.ts
â”‚   â”‚   â”‚   â””â”€â”€ order-item.entity.ts
â”‚   â”‚   â””â”€â”€ dto/
â”‚   â”‚       â”œâ”€â”€ create-order.dto.ts
â”‚   â”‚       â””â”€â”€ order-response.dto.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ outbox/                 # Outbox Pattern ëª¨ë“ˆ
â”‚   â”‚   â”œâ”€â”€ outbox.service.ts
â”‚   â”‚   â”œâ”€â”€ outbox-relay.service.ts  # Cron í´ë§
â”‚   â”‚   â”œâ”€â”€ outbox.module.ts
â”‚   â”‚   â””â”€â”€ entities/
â”‚   â”‚       â””â”€â”€ outbox.entity.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ user/                   # ì‚¬ìš©ì ê´€ë¦¬ ëª¨ë“ˆ
â”‚   â”‚   â”œâ”€â”€ user.controller.ts
â”‚   â”‚   â”œâ”€â”€ user.service.ts
â”‚   â”‚   â”œâ”€â”€ user.module.ts
â”‚   â”‚   â””â”€â”€ entities/
â”‚   â”‚       â””â”€â”€ user.entity.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ product/                # ìƒí’ˆ ê´€ë¦¬ ëª¨ë“ˆ
â”‚   â”‚   â”œâ”€â”€ product.controller.ts
â”‚   â”‚   â”œâ”€â”€ product.service.ts
â”‚   â”‚   â”œâ”€â”€ product.module.ts
â”‚   â”‚   â””â”€â”€ entities/
â”‚   â”‚       â””â”€â”€ product.entity.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ app.module.ts           # ë£¨íŠ¸ ëª¨ë“ˆ
â”‚   â”œâ”€â”€ app.controller.ts
â”‚   â”œâ”€â”€ app.service.ts
â”‚   â””â”€â”€ main.ts                 # ì• í”Œë¦¬ì¼€ì´ì…˜ ì—”íŠ¸ë¦¬í¬ì¸íŠ¸
â”‚
â”œâ”€â”€ public/                     # ì •ì  íŒŒì¼ (HTML UI)
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ dashboard.html
â”‚   â””â”€â”€ css/
â”‚
â”œâ”€â”€ dist/                       # ì»´íŒŒì¼ëœ íŒŒì¼ (ìë™ ìƒì„±)
â”œâ”€â”€ test/                       # E2E í…ŒìŠ¤íŠ¸
â”œâ”€â”€ .env.example                # í™˜ê²½ ë³€ìˆ˜ í…œí”Œë¦¿
â”œâ”€â”€ nest-cli.json               # NestJS CLI ì„¤ì •
â”œâ”€â”€ tsconfig.json               # TypeScript ì„¤ì •
â””â”€â”€ package.json                # ì˜ì¡´ì„± ë° ìŠ¤í¬ë¦½íŠ¸
```

## âš ï¸ ì•Œë ¤ì§„ ì œì•½ì‚¬í•­

### 1. Payment ê´€ë¦¬ ê´€ë ¨

ì£¼ë¬¸ MVP ì„œë¹„ìŠ¤ì´ë¯€ë¡œ ê·¸ ì´í›„ í”„ë¡œì„¸ìŠ¤ì¸ ê³„ì‚°ê³¼ payment ìƒíƒœ ê´€ë¦¬ ë“±ì€ ì²˜ë¦¬í•˜ì§€ ì•ŠìŒ.

**ì˜í–¥**: ClickHouse `orders_analytics` í…Œì´ë¸”ì˜ í•´ë‹¹ ì»¬ëŸ¼ì´ ë¶ˆì™„ì „í•œ ë°ì´í„°ë¡œ ì±„ì›Œì§‘ë‹ˆë‹¤.

## ğŸ“š ì°¸ê³  ë¬¸ì„œ

í”„ë¡œì íŠ¸ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ì˜ ë¬¸ì„œë¥¼ ì°¸ì¡°í•˜ì„¸ìš”:

- **ì „ì²´ ì•„í‚¤í…ì²˜**: `../docs/architecture/system-architecture-diagram.md`
- **êµ¬í˜„ ê°€ì´ë“œ**: `../docs/architecture/IMPLEMENTATION_GUIDE.md`
- **ADR**: `../docs/architecture/ADR-001-event-driven-architecture.md`
- **ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ**: `../docs/architecture/database-schema-design.md`
- **í”„ë¡œì íŠ¸ ê°œìš”**: `../CLAUDE.md`
- **Make ëª…ë ¹ì–´**: `../MAKEFILE_GUIDE.md`

## ğŸ”§ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### Kafka ì—°ê²° ì‹¤íŒ¨

```bash
# Kafka í´ëŸ¬ìŠ¤í„° ìƒíƒœ í™•ì¸
cd ..
make kafka-cluster-info

# í† í”½ ì¡´ì¬ í™•ì¸
make kafka-topics
```

### ClickHouse ì—°ê²° ì‹¤íŒ¨

```bash
# ClickHouse í—¬ìŠ¤ì²´í¬
curl http://localhost:8123/ping

# ë°±ì—”ë“œ í—¬ìŠ¤ì²´í¬ API
curl http://localhost:3000/api/analytics/health
```

### Outbox Relay ë™ì‘ í™•ì¸

```bash
# MySQL outbox í…Œì´ë¸” í™•ì¸
make mysql-shell
> SELECT COUNT(*), processed FROM outbox GROUP BY processed;

# ë°±ì—”ë“œ ë¡œê·¸ í™•ì¸
npm run start:dev
# "Relayed X events to Kafka" ë¡œê·¸ í™•ì¸
```

### ì „ì²´ íŒŒì´í”„ë¼ì¸ í…ŒìŠ¤íŠ¸

```bash
# í”„ë¡œì íŠ¸ ë£¨íŠ¸ì—ì„œ
cd ..
make test-pipeline
```

## ğŸ¤ ê¸°ì—¬

ì´ í”„ë¡œì íŠ¸ëŠ” MVP í•™ìŠµ ëª©ì ìœ¼ë¡œ ê°œë°œë˜ì—ˆìŠµë‹ˆë‹¤.

## ğŸ“„ ë¼ì´ì„ ìŠ¤

MIT License
